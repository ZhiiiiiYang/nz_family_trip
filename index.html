<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">
    
    <!-- App Icon & Title (iOS Home Screen) -->
    <meta name="apple-mobile-web-app-title" content="NZ Family Trip">
    <link rel="apple-touch-icon" href="https://files.catbox.moe/i0k4y6.jpg">
    <link rel="icon" href="https://files.catbox.moe/i0k4y6.jpg">

    <title>紐西蘭南北島・家族大旅行</title>
    
    <!-- FontAwesome (Icons) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">

    <!-- App Logic -->
    <script>
        document.addEventListener('alpine:init', () => {
            Alpine.data('itineraryApp', () => ({
                activeTab: 'itinerary',
                openDay: 0, 
                currentDayNum: 1,
                
                // Ledger Data (with Persistence)
                ledger: JSON.parse(localStorage.getItem('nz_ledger')) || [
                    {id: 1, name: '米佛峽灣遊船', cost: 570},
                    {id: 2, name: 'RealNZ 螢火蟲洞', cost: 2360},
                    {id: 3, name: '企鵝歸巢', cost: 735},
                    {id: 4, name: 'Heritage 農場', cost: 855},
                    {id: 5, name: '終極樹冠之旅', cost: 4613},
                    {id: 6, name: '空中纜車+滑板車', cost: 1629},
                    {id: 7, name: 'ZORB 水球', cost: 1692}
                ],
                newEntryName: '',
                newEntryCost: '',

                // Weather Data (Mock for Summer)
                weatherSouth: [
                    {day: '今天', icon: 'fa-sun', temp: '18°C', desc: '晴朗乾燥'},
                    {day: '明天', icon: 'fa-cloud-sun', temp: '16°C', desc: '多雲午後雨'},
                    {day: '週三', icon: 'fa-cloud-rain', temp: '14°C', desc: '早晚偏冷'},
                ],
                weatherNorth: [
                    {day: '今天', icon: 'fa-sun', temp: '24°C', desc: '陽光普照'},
                    {day: '明天', icon: 'fa-sun', temp: '25°C', desc: '紫外線強'},
                    {day: '週三', icon: 'fa-cloud-sun', temp: '23°C', desc: '舒適宜人'},
                ],

                // Souvenirs
                souvenirs: [
                    {name: 'Whittaker\'s 巧克力', desc: '超市必掃，推Hokey Pokey口味', icon: 'fa-candy-cane', color: '#5D4037'},
                    {name: 'Manuka 麥盧卡蜂蜜', desc: '認明UMF/MGO認證', icon: 'fa-jar', color: '#F59E0B'},
                    {name: 'Cookie Time', desc: '國民餅乾，微波加熱更好吃', icon: 'fa-cookie-bite', color: '#D97706'},
                    {name: 'Lanolin 綿羊油', desc: '保濕神物，價格親民', icon: 'fa-bottle-droplet', color: '#3B82F6'},
                    {name: '羊駝/羊毛製品', desc: '輕薄保暖，適合長輩', icon: 'fa-socks', color: '#6B7280'},
                ],

                // Extra Trips
                extraTrips: [
                    {name: 'Arrowtown 箭鎮', region: '近皇后鎮', desc: '魔戒取景地，淘金歷史古鎮', query: 'Arrowtown'},
                    {name: 'Akaroa 阿卡羅阿', region: '近基督城', desc: '充滿法式風情的海港小鎮', query: 'Akaroa'},
                    {name: 'Mt. John 天文台', region: '蒂卡波', desc: '俯瞰牛奶湖的最佳制高點', query: 'Mount John Observatory'},
                    {name: 'Hell\'s Gate 地獄之門', region: '羅托魯瓦', desc: '獨特的泥漿浴溫泉體驗', query: 'Hells Gate Geothermal Park'},
                ],

                tabs: [
                    {id: 'itinerary', name: '每日行程'},
                    {id: 'guide', name: '旅遊攻略'},
                    {id: 'budget', name: '記帳本'}
                ],

                days: [
                    {
                        date: '2025-12-22',
                        title: '抵達基督城',
                        route: 'AKL -> CHC',
                        km: '3km',
                        driveTime: '10m',
                        stay: 'Christchurch 住宿',
                        stayAddr: 'Christchurch, New Zealand', 
                        activities: [
                            {name: '抵達奧克蘭機場 (AKL)', desc: '12:00 抵達。務必提領行李，轉國內線。', type: 'transport', tip: '轉機時間緊湊(1h50m)，請快步移動。'},
                            {name: '飛往基督城 (CHC)', desc: '13:25 抵達。取租車。', type: 'transport'},
                            {name: '超市採買', desc: 'Pack\'n Save 或 Countdown 買水與早餐。', type: 'food'}
                        ]
                    },
                    {
                        date: '2025-12-23',
                        title: '前進藍色牛奶湖',
                        route: '基督城 -> 特威澤爾',
                        km: '280km',
                        driveTime: '3h',
                        stay: 'Twizel 住宿',
                        stayAddr: 'Twizel, New Zealand',
                        activities: [
                            {name: 'Lake Tekapo 蒂卡波湖', desc: '魯冰花盛開季，絕美湖景。', type: 'view', tip: '湖邊風大，記得戴帽子。'},
                            {name: '好牧羊人教堂', desc: '經典地標。', type: 'view'},
                            {name: 'Lake Pukaki', desc: '著名的藍色牛奶湖，可遠眺庫克山。', type: 'view', tip: '必吃路邊 Mt Cook Alpine Salmon 生魚片！'},
                            {name: '暗空保護區觀星', desc: '若天氣好，抬頭即見銀河。', type: 'star'}
                        ]
                    },
                    {
                        date: '2025-12-24',
                        title: '平安夜玩瓦納卡',
                        route: '特威澤爾 -> 瓦納卡',
                        km: '120km',
                        driveTime: '2h',
                        stay: 'Wanaka 住宿',
                        stayAddr: 'Wanaka, New Zealand',
                        activities: [
                            {name: 'Wanaka Lavender Farm', desc: '紫色夢幻花海，吃薰衣草冰淇淋。', type: 'view'},
                            {name: 'Puzzling World', desc: '錯視藝術迷宮。', type: 'fun', tip: '12/25 沒開，今天先玩！'},
                            {name: '瓦納卡孤獨樹', desc: '湖中孤樹，黃昏最美。', type: 'view'},
                            {name: '平安夜大餐', desc: '餐廳需預訂，或超市買牛排回民宿煮。', type: 'food'}
                        ]
                    },
                    {
                        date: '2025-12-25',
                        title: '聖誕節慢活',
                        route: '瓦納卡一日遊',
                        km: '-',
                        driveTime: '-',
                        stay: 'Wanaka 住宿',
                        stayAddr: 'Wanaka, New Zealand',
                        activities: [
                            {name: 'Mount Iron Track', desc: '健行約2小時，俯瞰全景。', type: 'hike'},
                            {name: 'Rippon Vineyard', desc: '世界最美酒莊之一，免費品酒。', type: 'view', tip: '留意聖誕節營業時間，通常下午5點關。'},
                            {name: '湖畔野餐', desc: '享受悠閒聖誕午後。', type: 'food'}
                        ]
                    },
                    {
                        date: '2025-12-26',
                        title: '水果之鄉與螢火蟲',
                        route: '瓦納卡 -> 蒂阿瑙',
                        km: '230km',
                        driveTime: '3h',
                        stay: 'Te Anau 住宿',
                        stayAddr: 'Te Anau, New Zealand',
                        activities: [
                            {name: 'Cromwell 水果鎮', desc: 'Jones Family Fruit Stall 買櫻桃、水蜜桃。', type: 'food'},
                            {name: 'RealNZ 螢火蟲洞', desc: '搭船入洞看藍光星河。', type: 'view', tip: '洞內不能拍照，用心欣賞。'},
                            {name: 'Te Anau 湖畔', desc: '南島第一大湖。', type: 'view'}
                        ]
                    },
                    {
                        date: '2025-12-27',
                        title: '世界遺產米佛峽灣',
                        route: '蒂阿瑙 -> 米佛 -> 但尼丁',
                        km: '430km',
                        driveTime: '9h(含遊)',
                        stay: 'Dunedin 住宿',
                        stayAddr: 'Dunedin, New Zealand',
                        activities: [
                            {name: '前往米佛峽灣', desc: '07:30 出發。經鏡湖、Eglinton Valley。', type: 'transport', tip: '容易暈車者請先吃藥。'},
                            {name: '峽灣遊船', desc: '11:00 船班。看瀑布、海豹。', type: 'view', tip: '甲板風極大，需穿防風防水外套。'},
                            {name: '長途拉車至但尼丁', desc: '經 Lumsden 休息。', type: 'transport'}
                        ]
                    },
                    {
                        date: '2025-12-28',
                        title: '蘇格蘭風情古都',
                        route: '但尼丁 -> 奧瑪魯',
                        km: '120km',
                        driveTime: '1.5h',
                        stay: 'Oamaru 住宿',
                        stayAddr: 'Oamaru, New Zealand',
                        activities: [
                            {name: '但尼丁火車站', desc: '華麗復古建築。', type: 'view'},
                            {name: '鮑德溫街 (Baldwin St)', desc: '世界最陡街道。', type: 'fun'},
                            {name: '奧瑪魯維多利亞老街', desc: '蒸汽龐克風格。', type: 'view'},
                            {name: '藍企鵝歸巢', desc: '約 20:45 開始。', type: 'view', tip: '海邊晚上極冷，禁止拍照。'}
                        ]
                    },
                    {
                        date: '2025-12-29',
                        title: '東海岸返回',
                        route: '奧瑪魯 -> 基督城',
                        km: '250km',
                        driveTime: '3h',
                        stay: 'Christchurch 住宿',
                        stayAddr: 'Christchurch, New Zealand',
                        activities: [
                            {name: 'Caroline Bay', desc: '蒂瑪魯海灘，可能有海豹。', type: 'view'},
                            {name: '抵達基督城還車', desc: '算好時間還車。', type: 'transport'}
                        ]
                    },
                    {
                        date: '2025-12-30',
                        title: '花園城市漫遊',
                        route: '基督城自由行',
                        km: '-',
                        driveTime: '-',
                        stay: 'Christchurch 住宿',
                        stayAddr: 'Christchurch, New Zealand',
                        activities: [
                            {name: '植物園 & 雅芳河', desc: '英式撐船體驗。', type: 'view'},
                            {name: '紙板教堂', desc: '地震後重建地標。', type: 'view'},
                            {name: 'Riverside Market', desc: '美食市集晚餐。', type: 'food'}
                        ]
                    },
                    {
                        date: '2025-12-31',
                        title: '紐西蘭跨年！',
                        route: '基督城',
                        km: '-',
                        driveTime: '-',
                        stay: 'Christchurch 住宿',
                        stayAddr: 'Christchurch, New Zealand',
                        activities: [
                            {name: 'North Hagley Park', desc: '跨年音樂會。', type: 'fun', tip: '帶野餐墊與保暖衣物。'},
                            {name: '3...2...1 Happy New Year!', desc: '全球最早跨年國家之一。', type: 'fun'}
                        ]
                    },
                    {
                        date: '2026-01-01',
                        title: '飛向北島火山',
                        route: 'CHC -> Ohakune',
                        km: '320km',
                        driveTime: '4.5h',
                        stay: 'Ohakune 住宿',
                        stayAddr: 'Ohakune, New Zealand',
                        activities: [
                            {name: '飛往威靈頓 (WLG)', desc: '12:15 起飛，13:30 抵達。', type: 'transport'},
                            {name: '租車北上', desc: '前往國家公園區。', type: 'transport'}
                        ]
                    },
                    {
                        date: '2026-01-02',
                        title: '火山與陶波湖',
                        route: 'Ohakune -> 陶波',
                        km: '150km',
                        driveTime: '2h',
                        stay: '10 Wiremu Street, Turangi',
                        stayAddr: '10 Wiremu Street, Turangi',
                        activities: [
                            {name: 'Whakapapa Village', desc: '眺望 Ruapehu 火山。', type: 'view'},
                            {name: 'Taranaki Falls', desc: '步道健行看瀑布。', type: 'hike'},
                            {name: '陶波麥當勞', desc: '在飛機裡吃漢堡。', type: 'food'},
                            {name: 'Huka Prawn Park', desc: '釣蝦吃蝦親子樂。', type: 'fun'}
                        ]
                    },
                    {
                        date: '2026-01-03',
                        title: '森林樹冠層探險',
                        route: '陶波 -> 羅托魯瓦',
                        km: '80km',
                        driveTime: '1h',
                        stay: 'Rotorua 住宿',
                        stayAddr: 'Rotorua, New Zealand',
                        activities: [
                            {name: 'Canopy Tours', desc: '3小時樹冠層滑索，刺激！', type: 'fun'},
                            {name: 'Redwoods Treewalk', desc: '夜間紅木森林吊橋，如阿凡達場景。', type: 'view'}
                        ]
                    },
                    {
                        date: '2026-01-04',
                        title: '農場與纜車',
                        route: '羅托魯瓦',
                        km: '-',
                        driveTime: '-',
                        stay: 'Rotorua 住宿',
                        stayAddr: 'Rotorua, New Zealand',
                        activities: [
                            {name: 'Agrodome Heritage 農場', desc: '摸羊駝、看剪羊毛秀。', type: 'fun'},
                            {name: 'Skyline Rotorua', desc: '纜車+Luge滑板車(5圈)。', type: 'fun', tip: '滑板車超好玩，必玩！'}
                        ]
                    },
                    {
                        date: '2026-01-05',
                        title: '地熱奇觀與滾球',
                        route: '羅托魯瓦',
                        km: '-',
                        driveTime: '-',
                        stay: '4 Westbourne Ave, Rotorua',
                        stayAddr: '4 Westbourne Avenue, Rotorua',
                        activities: [
                            {name: 'Lady Knox Geyser', desc: '10:15 準時噴發。', type: 'view'},
                            {name: 'Wai-O-Tapu', desc: '彩色香檳池地熱。', type: 'view', tip: '硫磺味重，但景色特別。'},
                            {name: 'ZORB 水球', desc: '人進球裡滾下山坡。', type: 'fun', tip: '記得帶泳衣毛巾。'}
                        ]
                    },
                    {
                        date: '2026-01-06',
                        title: '前往奧克蘭',
                        route: '羅托魯瓦 -> 奧克蘭',
                        km: '230km',
                        driveTime: '3h',
                        stay: '64 Federal St, Auckland',
                        stayAddr: '64 Federal Street, Auckland',
                        activities: [
                            {name: '開車北上', desc: '前往奧克蘭。', type: 'transport'},
                            {name: '還車 & 入住', desc: '14:30 前還車。', type: 'transport'},
                            {name: 'Federal St 晚餐', desc: '市區享用美食。', type: 'food'}
                        ]
                    },
                    {
                        date: '2026-01-07',
                        title: '千帆之都',
                        route: '奧克蘭',
                        km: '-',
                        driveTime: '-',
                        stay: '64 Federal St, Auckland',
                        stayAddr: '64 Federal Street, Auckland',
                        activities: [
                            {name: 'Queen Street', desc: '最後購物衝刺。', type: 'shop'},
                            {name: 'Sky Tower', desc: '南半球最高塔。', type: 'view'},
                            {name: 'Britomart', desc: '海港區散步。', type: 'view'}
                        ]
                    },
                    {
                        date: '2026-01-08',
                        title: '再見紐西蘭',
                        route: 'AKL -> TPE',
                        km: '-',
                        driveTime: '-',
                        stay: '-',
                        activities: [
                            {name: '前往機場', desc: '搭機返台。', type: 'transport'},
                            {name: 'Sweet Home', desc: '10:45 起飛。', type: 'transport'}
                        ]
                    }
                ],

                init() {
                    this.updateCurrentDay();
                    if (isNaN(this.currentDayNum) || this.currentDayNum < 1) this.currentDayNum = 1;
                    
                    // Watch for ledger changes to save persistence
                    this.$watch('ledger', (val) => {
                        localStorage.setItem('nz_ledger', JSON.stringify(val));
                    });
                },

                updateCurrentDay() {
                    const startDate = new Date('2025-12-21');
                    const today = new Date();
                    if (isNaN(today.getTime())) return;
                    
                    const diffTime = today - startDate;
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 
                    this.currentDayNum = diffDays;
                },

                // CRUD Logic
                addLedgerItem() {
                    if(!this.newEntryName || !this.newEntryCost) return;
                    this.ledger.push({
                        id: Date.now(),
                        name: this.newEntryName,
                        cost: parseInt(this.newEntryCost)
                    });
                    this.newEntryName = '';
                    this.newEntryCost = '';
                },

                removeLedgerItem(id) {
                    this.ledger = this.ledger.filter(item => item.id !== id);
                },

                getTotalCost() {
                    return this.ledger.reduce((sum, item) => sum + (parseInt(item.cost) || 0), 0).toLocaleString();
                },

                toggleDay(index) {
                    this.openDay = (this.openDay === index) ? -1 : index;
                },

                formatDate(dateStr) {
                    const date = new Date(dateStr);
                    return date.getDate();
                },
                
                formatMonth(dateStr) {
                    const date = new Date(dateStr);
                    return date.toLocaleString('default', { month: 'short' });
                },
                
                isPast(dateStr) {
                    const date = new Date(dateStr);
                    const today = new Date('2025-12-22');
                    return date < today;
                },

                getMapLink(query) {
                    return `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(query + ' New Zealand')}`;
                },
                
                getDotColor(type) {
                    const map = {
                        transport: 'dot-gray',
                        food: 'dot-orange',
                        stay: 'dot-indigo',
                        view: 'dot-green',
                        fun: 'dot-red',
                        shop: 'dot-purple',
                        star: 'dot-blue',
                        hike: 'dot-emerald'
                    };
                    return map[type] || 'dot-gray';
                }
            }));
        });
    </script>

    <!-- Alpine.js -->
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js"></script>

    <style>
        /* === RESET & VARIABLES === */
        :root {
            --primary: #5D7E68;
            --secondary: #D4A373;
            --bg: #F9F7F2;
            --text-main: #2C3E50;
            --text-light: #64748B;
            --card-bg: rgba(255, 255, 255, 0.95);
            --safe-top: env(safe-area-inset-top, 20px);
            --safe-bottom: env(safe-area-inset-bottom, 20px);
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg);
            font-family: 'Noto Sans TC', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            color: var(--text-main);
            -webkit-font-smoothing: antialiased;
            padding-bottom: calc(90px + var(--safe-bottom));
            min-height: 100vh;
            min-height: 100dvh;
        }

        [x-cloak] { display: none !important; }

        /* === TYPOGRAPHY === */
        h1, h2, h3, h4 { margin: 0; font-weight: 700; }
        .font-serif { font-family: 'Playfair Display', serif; }
        
        /* === LAYOUT UTILS === */
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .justify-center { justify-content: center; }
        .flex-1 { flex: 1; }
        .shrink-0 { flex-shrink: 0; }
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .relative { position: relative; }
        .absolute { position: absolute; }
        .hidden { display: none; }
        .block { display: block; }
        .w-full { width: 100%; }
        .mt-2 { margin-top: 0.5rem; }
        .mt-4 { margin-top: 1rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mr-2 { margin-right: 0.5rem; }
        .ml-2 { margin-left: 0.5rem; }
        .p-4 { padding: 1rem; }
        .p-5 { padding: 1.25rem; }
        .px-4 { padding-left: 1rem; padding-right: 1rem; }
        
        /* === COMPONENTS === */
        
        /* Header */
        header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(249, 247, 242, 0.95);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0,0,0,0.05);
            z-index: 50;
            padding-top: calc(10px + var(--safe-top));
            padding-bottom: 10px;
            padding-left: 20px;
            padding-right: 20px;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            max-width: 600px;
            margin: 0 auto;
        }

        .subtitle { font-size: 10px; letter-spacing: 2px; color: var(--primary); text-transform: uppercase; font-weight: 700; }
        .title { font-size: 24px; color: #333; }
        .day-counter { font-size: 24px; color: var(--secondary); font-weight: 700; }

        /* Main Container */
        main {
            margin-top: calc(90px + var(--safe-top));
            padding: 0 16px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Tabs */
        .tabs-container {
            position: sticky;
            top: calc(75px + var(--safe-top));
            z-index: 40;
            background: linear-gradient(to bottom, var(--bg) 80%, transparent);
            padding: 10px 0;
            margin: 0 -16px 16px -16px; 
            padding-left: 16px; 
            display: flex;
            gap: 10px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .tabs-container::-webkit-scrollbar { display: none; }

        .tab-btn {
            background: #fff;
            border: 1px solid rgba(0,0,0,0.05);
            padding: 8px 16px;
            border-radius: 999px;
            font-size: 14px;
            font-weight: 700;
            color: #999;
            white-space: nowrap;
            transition: all 0.2s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.02);
        }

        .tab-btn.active {
            background: var(--primary);
            color: #fff;
            transform: scale(1.05);
            box-shadow: 0 4px 10px rgba(93, 126, 104, 0.3);
        }

        /* Card Style */
        .card {
            background: var(--card-bg);
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.6);
            box-shadow: 0 4px 20px rgba(0,0,0,0.03);
            margin-bottom: 16px;
            overflow: hidden;
            transition: transform 0.2s;
        }
        
        .card.expanded {
            box-shadow: 0 10px 30px rgba(0,0,0,0.06);
            border-color: var(--primary);
        }

        .card.past {
            opacity: 0.7;
            filter: grayscale(0.5);
        }

        /* Date Badge */
        .date-badge {
            width: 50px;
            height: 50px;
            background: #f3f4f6;
            border-radius: 14px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        .date-badge.active { background: var(--primary); color: #fff; }
        .date-badge span:first-child { font-size: 10px; text-transform: uppercase; font-weight: 700; }
        .date-badge span:last-child { font-size: 20px; font-weight: 700; line-height: 1; }

        /* Flight Card Special */
        .flight-card {
            border-left: 6px solid var(--primary); 
            border-left-color: #6B8E9B; 
        }
        
        .flight-line {
            height: 2px;
            background: #e5e7eb;
            position: relative;
            margin: 0 10px;
            flex: 1;
        }
        .flight-line::before, .flight-line::after {
            content: ''; position: absolute; top: -3px; width: 8px; height: 8px; border-radius: 50%;
        }
        .flight-line::before { left: 0; background: #ccc; }
        .flight-line::after { right: 0; background: #6B8E9B; }
        .plane-icon-center { position: absolute; top: -8px; left: 50%; transform: translateX(-50%); color: #6B8E9B; font-size: 12px;}

        /* Timeline */
        .timeline-container {
            position: relative;
            padding-left: 16px;
            margin-left: 8px;
        }
        
        .timeline-item {
            position: relative;
            padding-bottom: 24px;
        }
        
        .timeline-line {
            position: absolute;
            left: 7px;
            top: 15px;
            bottom: -15px;
            width: 2px;
            background: #e5e7eb;
        }
        .timeline-item:last-child .timeline-line { display: none; }

        .timeline-dot {
            position: absolute;
            left: -2px;
            top: 4px;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            border: 3px solid #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            z-index: 10;
        }

        /* Dot Colors */
        .dot-gray { background: #9ca3af; }
        .dot-orange { background: #fb923c; }
        .dot-indigo { background: #6366f1; }
        .dot-green { background: #5D7E68; }
        .dot-red { background: #ef4444; }
        .dot-purple { background: #c084fc; }
        .dot-blue { background: #1e40af; }
        .dot-emerald { background: #059669; }

        .activity-content {
            padding-left: 24px;
            display: flex;
            justify-content: space-between;
            align-items: start;
        }

        /* Map Button */
        .map-btn {
            width: 32px;
            height: 32px;
            background: #f9fafb;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #9ca3af;
            text-decoration: none;
            flex-shrink: 0;
            margin-left: 10px;
            transition: all 0.2s;
        }
        .map-btn:active { background: var(--primary); color: #fff; }

        /* Tip Box */
        .tip-box {
            display: inline-flex;
            align-items: flex-start;
            background: #fffbeb;
            border: 1px solid #fcd34d;
            color: #92400e;
            font-size: 11px;
            padding: 6px 10px;
            border-radius: 8px;
            margin-top: 8px;
            line-height: 1.4;
        }

        /* Bottom Nav (Wider) */
        .bottom-nav {
            position: fixed;
            bottom: calc(20px + var(--safe-bottom));
            left: 50%;
            transform: translateX(-50%);
            background: rgba(44, 62, 80, 0.95);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 12px 0;
            width: 90%;
            max-width: 450px;
            border-radius: 99px;
            display: flex;
            justify-content: space-around;
            box-shadow: 0 10px 25px rgba(0,0,0,0.25);
            z-index: 100;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .nav-btn {
            background: none;
            border: none;
            color: #94a3b8;
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 11px;
            font-weight: 500;
            width: 60px;
        }
        
        .nav-btn i { font-size: 20px; margin-bottom: 4px; transition: transform 0.2s; }
        .nav-btn.active { color: var(--secondary); font-weight: 700; }
        .nav-btn.active i { transform: translateY(-2px); }

        /* Budget Table & Form */
        .budget-table { width: 100%; border-collapse: collapse; }
        .budget-table th { text-align: left; padding: 12px 16px; background: #f9fafb; font-size: 12px; color: #6b7280; text-transform: uppercase; }
        .budget-table td { padding: 14px 16px; border-bottom: 1px solid #f3f4f6; font-size: 14px; vertical-align: middle; }
        .budget-table td:nth-child(2) { text-align: right; font-weight: 700; font-family: monospace; }
        .budget-table td:last-child { width: 40px; text-align: center; }
        
        .delete-btn { color: #ef4444; background: none; border: none; font-size: 14px; padding: 8px; cursor: pointer; opacity: 0.5; }
        .delete-btn:active { opacity: 1; }
        
        .add-form { background: #f3f4f6; padding: 16px; display: flex; gap: 10px; align-items: center; border-bottom: 1px solid #e5e7eb; }
        .form-input { flex: 1; padding: 10px; border-radius: 8px; border: 1px solid #d1d5db; font-size: 14px; outline: none; }
        .form-input:focus { border-color: var(--primary); }
        .add-btn { background: var(--primary); color: white; border: none; width: 40px; height: 40px; border-radius: 8px; display: flex; align-items: center; justify-content: center; cursor: pointer; }

        /* Weather Forecast UI */
        .forecast-container { display: flex; flex-direction: column; gap: 12px; }
        .forecast-row { display: flex; align-items: center; background: rgba(255,255,255,0.7); padding: 10px 15px; border-radius: 12px; justify-content: space-between; }
        .forecast-date { font-weight: bold; font-size: 14px; color: #333; width: 40px; }
        .forecast-icon { font-size: 18px; color: #fbbf24; width: 30px; text-align: center; }
        .forecast-temp { font-weight: bold; font-size: 16px; color: #333; width: 50px; text-align: right; }
        .forecast-desc { font-size: 12px; color: #666; text-align: right; flex: 1; }
        .island-title { font-size: 12px; font-weight: 700; color: #666; margin: 10px 0 5px 5px; text-transform: uppercase; letter-spacing: 1px; }

        /* Souvenir List */
        .souvenir-item { display: flex; align-items: center; background: white; padding: 12px; border-radius: 12px; margin-bottom: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.02); }
        .souvenir-icon { width: 40px; height: 40px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 18px; color: white; margin-right: 12px; flex-shrink: 0; }
        .souvenir-info h4 { font-size: 14px; margin-bottom: 2px; }
        .souvenir-info p { font-size: 11px; color: #666; margin: 0; }

        /* Extra Trip Card */
        .trip-card { background: white; border-radius: 16px; padding: 15px; margin-bottom: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.03); display: flex; justify-content: space-between; align-items: center; }
        .trip-info h4 { font-size: 15px; color: #333; margin-bottom: 4px; }
        .trip-info .tag { font-size: 10px; background: #e0f2f1; color: #0f766e; padding: 2px 6px; border-radius: 4px; display: inline-block; margin-bottom: 4px; }
        .trip-info p { font-size: 12px; color: #666; margin: 0; }
        .nav-round-btn { background: #f3f4f6; color: var(--primary); width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; text-decoration: none; }

    </style>
</head>
<body x-data="itineraryApp" x-cloak>

    <!-- Header -->
    <header>
        <div class="header-content">
            <div>
                <div class="subtitle">New Zealand 2025-26</div>
                <h1 class="title font-serif">紐西蘭・夏日漫遊</h1>
            </div>
            <div class="text-right">
                <div style="font-size: 10px; color: #999; text-transform: uppercase;">Day</div>
                <div class="day-counter font-serif" x-text="currentDayNum"></div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main>

        <!-- Tab Navigation -->
        <div class="tabs-container">
            <template x-for="tab in tabs">
                <button 
                    @click="activeTab = tab.id; window.scrollTo({top: 0, behavior: 'smooth'})"
                    class="tab-btn"
                    :class="activeTab === tab.id ? 'active' : ''"
                    x-text="tab.name">
                </button>
            </template>
        </div>

        <!-- 1. ITINERARY VIEW -->
        <div x-show="activeTab === 'itinerary'" x-transition.opacity>
            
            <!-- Flight Card -->
            <div class="card flight-card p-5">
                <div class="flex justify-between items-center mb-4">
                    <span style="background:#6B8E9B; color:white; font-size:10px; font-weight:bold; padding:2px 6px; border-radius:4px;">FLIGHT</span>
                    <span style="font-size:12px; color:#999; font-family:monospace;">TRIP START</span>
                </div>
                
                <div class="flex items-center justify-between">
                    <div class="text-center">
                        <div style="font-size:24px; font-weight:700;">TPE</div>
                        <div style="font-size:12px; color:#666;">台北</div>
                    </div>
                    
                    <div class="flight-line">
                        <i class="fa-solid fa-plane plane-icon-center"></i>
                    </div>
                    
                    <div class="text-center">
                        <div style="font-size:24px; font-weight:700;">AKL</div>
                        <div style="font-size:12px; color:#666;">奧克蘭</div>
                    </div>
                </div>

                <div class="tip-box" style="width:100%; border-color:#fecaca; background:#fef2f2; color:#b91c1c; margin-top:16px;">
                    <i class="fa-solid fa-triangle-exclamation" style="margin-right:6px; margin-top:2px;"></i> 
                    <div>
                        <span style="font-weight:bold; display:block;">轉機重要提醒</span>
                        在奧克蘭必須 <span style="text-decoration:underline;">提領行李</span> 並重新check-in國內線！
                    </div>
                </div>
            </div>

            <!-- Days List -->
            <template x-for="(day, index) in days" :key="index">
                <div class="card" :class="{'expanded': openDay === index, 'past': isPast(day.date) && openDay !== index}">
                    
                    <!-- Card Header -->
                    <div @click="toggleDay(index)" class="p-5 flex items-center justify-between" style="cursor: pointer;">
                        <div class="flex items-center" style="gap: 16px;">
                            <div class="date-badge" :class="{'active': openDay === index}">
                                <span x-text="formatMonth(day.date)"></span>
                                <span x-text="formatDate(day.date)"></span>
                            </div>
                            <div style="min-width: 0; flex: 1;"> <!-- Fix for text overflow -->
                                <h3 style="font-size:16px; margin-bottom:4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;" x-text="day.title"></h3>
                                <div style="font-size:12px; color:#666; display:flex; items-align:center;">
                                    <span style="width:6px; height:6px; background:var(--secondary); border-radius:50%; margin-right:6px; margin-top:5px;"></span>
                                    <span style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;" x-text="day.route"></span>
                                </div>
                            </div>
                        </div>
                        <i class="fa-solid fa-chevron-down" style="color:#ccc; transition:0.3s;" :style="openDay === index ? 'transform:rotate(180deg); color:var(--primary)' : ''"></i>
                    </div>

                    <!-- Card Body -->
                    <div x-show="openDay === index" x-collapse style="border-top:1px solid #f3f4f6;">
                        <!-- Transport Info -->
                        <div class="px-4 py-2" style="background:#f9fafb; display:flex; gap:20px; font-size:12px; color:#666; font-weight:500;">
                            <span x-show="day.km !== '-'"><i class="fa-solid fa-road mr-2"></i> <span x-text="day.km"></span></span>
                            <span x-show="day.driveTime !== '-'"><i class="fa-regular fa-clock mr-2"></i> <span x-text="day.driveTime"></span></span>
                        </div>

                        <!-- Timeline -->
                        <div class="p-5">
                            <div class="timeline-container">
                                <template x-for="(item, idx) in day.activities">
                                    <div class="timeline-item">
                                        <div class="timeline-line"></div>
                                        <div class="timeline-dot" :class="getDotColor(item.type)"></div>
                                        
                                        <div class="activity-content">
                                            <div style="flex:1; min-width:0;">
                                                <div style="font-weight:700; font-size:14px; margin-bottom:4px;" x-text="item.name"></div>
                                                <div style="font-size:12px; color:#666; line-height:1.5;" x-text="item.desc"></div>
                                                
                                                <div x-show="item.tip" class="tip-box">
                                                    <i class="fa-solid fa-lightbulb" style="margin-right:6px; color:#f59e0b;"></i>
                                                    <span x-text="item.tip"></span>
                                                </div>
                                            </div>
                                            <a :href="getMapLink(item.name)" target="_blank" class="map-btn">
                                                <i class="fa-solid fa-location-arrow" style="font-size:12px;"></i>
                                            </a>
                                        </div>
                                    </div>
                                </template>
                            </div>

                            <!-- Stay Info -->
                            <div x-show="day.stay && day.stay !== '-'" style="margin-top:10px; padding-top:16px; border-top:1px solid #f3f4f6;">
                                <div style="display:flex; background:#eef2ff; border-radius:12px; padding:12px; border:1px solid #e0e7ff;">
                                    <div style="width:32px; height:32px; background:#e0e7ff; color:#6366f1; border-radius:50%; display:flex; align-items:center; justify-content:center; margin-right:12px;">
                                        <i class="fa-solid fa-bed" style="font-size:12px;"></i>
                                    </div>
                                    <div style="flex:1;">
                                        <div style="font-size:10px; font-weight:700; color:#818cf8; text-transform:uppercase;">Tonight's Stay</div>
                                        <div style="font-size:14px; font-weight:700; color:#333;" x-text="day.stay"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </template>
            <div style="height: 40px;"></div>
        </div>

        <!-- 2. GUIDE VIEW -->
        <div x-show="activeTab === 'guide'" x-transition.opacity>
            
            <!-- Weather Forecast Widget -->
            <div class="card p-5" style="background: linear-gradient(180deg, #e0f7fa 0%, #ffffff 100%); border:none;">
                <h3 class="font-serif" style="margin-bottom:12px; color:#0e7490;">天氣預報</h3>
                
                <!-- South Island -->
                <div class="island-title">南島 (基督城/皇后鎮)</div>
                <div class="forecast-container">
                    <template x-for="w in weatherSouth">
                        <div class="forecast-row">
                            <div class="forecast-date" x-text="w.day"></div>
                            <div class="forecast-icon"><i class="fa-solid" :class="w.icon"></i></div>
                            <div class="forecast-temp" x-text="w.temp"></div>
                            <div class="forecast-desc" x-text="w.desc"></div>
                        </div>
                    </template>
                </div>

                <!-- North Island -->
                <div class="island-title" style="margin-top:20px;">北島 (奧克蘭/羅托魯瓦)</div>
                <div class="forecast-container">
                    <template x-for="w in weatherNorth">
                        <div class="forecast-row">
                            <div class="forecast-date" x-text="w.day"></div>
                            <div class="forecast-icon"><i class="fa-solid" :class="w.icon"></i></div>
                            <div class="forecast-temp" x-text="w.temp"></div>
                            <div class="forecast-desc" x-text="w.desc"></div>
                        </div>
                    </template>
                </div>
            </div>

            <!-- Souvenirs -->
            <h3 style="margin: 24px 0 12px 4px; font-size: 18px;">必買伴手禮清單</h3>
            <div style="margin-bottom: 24px;">
                <template x-for="item in souvenirs">
                    <div class="souvenir-item">
                        <div class="souvenir-icon" :style="`background: ${item.color}`">
                            <i class="fa-solid" :class="item.icon"></i>
                        </div>
                        <div class="souvenir-info">
                            <h4 x-text="item.name"></h4>
                            <p x-text="item.desc"></p>
                        </div>
                    </div>
                </template>
            </div>

            <!-- Extra Trips -->
            <h3 style="margin: 0 0 12px 4px; font-size: 18px;">沿途順遊推薦</h3>
            <div style="margin-bottom: 24px;">
                <template x-for="trip in extraTrips">
                    <div class="trip-card">
                        <div class="trip-info">
                            <span class="tag" x-text="trip.region"></span>
                            <h4 x-text="trip.name"></h4>
                            <p x-text="trip.desc"></p>
                        </div>
                        <a :href="getMapLink(trip.query)" target="_blank" class="nav-round-btn">
                            <i class="fa-solid fa-location-dot"></i>
                        </a>
                    </div>
                </template>
            </div>

            <div class="card p-5" style="border-left:4px solid #ef4444; background:#fef2f2;">
                <h3 style="color:#b91c1c; font-size:16px; margin-bottom:12px;"><i class="fa-solid fa-car-side mr-2"></i> 自駕生死守則</h3>
                <ul style="padding-left:20px; font-size:14px; color:#7f1d1d; line-height:1.6;">
                    <li><strong>右駕靠左！</strong>雨刷方向燈相反。</li>
                    <li>圓環 (Roundabout) 禮讓右方來車。</li>
                    <li>單線橋樑看箭頭優先權。</li>
                </ul>
            </div>
            <div style="height: 40px;"></div>
        </div>

        <!-- 3. BUDGET (LEDGER) VIEW -->
        <div x-show="activeTab === 'budget'" x-transition.opacity>
            <div class="card" style="overflow:hidden;">
                <!-- Total Header -->
                <div style="background:#2C3E50; color:white; padding:24px; position:relative;">
                    <h3 class="font-serif">旅費總支出</h3>
                    <div style="font-size:32px; font-weight:700; margin-top:8px;" x-text="'$' + getTotalCost()"></div>
                    <div style="font-size:12px; opacity:0.7;">TWD (自動加總)</div>
                    <div style="position:absolute; right:20px; top:24px; opacity:0.2; font-size:40px;">
                        <i class="fa-solid fa-wallet"></i>
                    </div>
                </div>

                <!-- Add New Entry Form -->
                <div class="add-form">
                    <input type="text" x-model="newEntryName" placeholder="項目名稱" class="form-input" style="flex:2;">
                    <input type="number" x-model="newEntryCost" placeholder="$" class="form-input" style="flex:1;">
                    <button @click="addLedgerItem()" class="add-btn">
                        <i class="fa-solid fa-plus"></i>
                    </button>
                </div>
                
                <!-- Ledger List -->
                <table class="budget-table">
                    <tbody>
                        <template x-for="item in ledger" :key="item.id">
                            <tr>
                                <td x-text="item.name" style="color:#4b5563;"></td>
                                <td x-text="item.cost"></td>
                                <td>
                                    <button @click="removeLedgerItem(item.id)" class="delete-btn">
                                        <i class="fa-regular fa-trash-can"></i>
                                    </button>
                                </td>
                            </tr>
                        </template>
                    </tbody>
                </table>
                <div style="background:#f9fafb; padding:15px; text-align:center; font-size:12px; color:#9ca3af; line-height:1.4;">
                    資料自動儲存於此手機<br>
                    <span style="font-size:10px;">* 請勿清除瀏覽器快取以免資料遺失</span>
                </div>
            </div>
            <div style="height: 40px;"></div>
        </div>

    </main>

    <!-- Bottom Nav -->
    <nav class="bottom-nav">
        <button @click="activeTab = 'itinerary'; window.scrollTo({top: 0, behavior: 'smooth'})" 
                class="nav-btn" :class="activeTab === 'itinerary' ? 'active' : ''">
            <i class="fa-solid fa-map"></i> 行程
        </button>
        <button @click="activeTab = 'guide'; window.scrollTo({top: 0, behavior: 'smooth'})" 
                class="nav-btn" :class="activeTab === 'guide' ? 'active' : ''">
            <i class="fa-solid fa-compass"></i> 攻略
        </button>
        <button @click="activeTab = 'budget'; window.scrollTo({top: 0, behavior: 'smooth'})" 
                class="nav-btn" :class="activeTab === 'budget' ? 'active' : ''">
            <i class="fa-solid fa-receipt"></i> 記帳
        </button>
    </nav>

</body>
</html>
